<!--

To run this demo, you need to replace 'YOUR_ACCESS_TOKEN' with an access token from ArcGIS that has the correct privileges.

To get started, sign up for a free ArcGIS Location Platform account or a free trial of ArcGIS Online and create developer credentials.

https://developers.arcgis.com/documentation/security-and-authentication/get-started/

-->


<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>OpenLayers Tutorials: Add a feature layer</title>

    <style>
    html,
    body,
    #map {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 14px;
      color: #323232;
    }
    </style>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.7.0/ol.css">
    <script src="https://cdn.jsdelivr.net/npm/ol@v10.7.0/dist/ol.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/ol-mapbox-style@13.1.1/dist/olms.js"></script>

    <script src="https://unpkg.com/@esri/arcgis-rest-request@4/dist/bundled/request.umd.js"></script>
    <script src="https://unpkg.com/ol-popup@5.1.1/dist/ol-popup.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/ol-popup@5.1.1/src/ol-popup.css">

  </head>

  <body>
    <div id="map"></div>

    <script>

    /* Use for API key authentication */
    const accessToken = session.token;

    const map = new ol.Map({
      target: "map"
    });

    map.setView(
      new ol.View({
        center: ol.proj.fromLonLat([-97.469580,38.297482]),
        zoom: 4
      })
    );

    const basemapId = "arcgis/light-gray";
    const basemapURL = `https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/styles/${basemapId}?token=${accessToken}`;

    olms.apply(map, basemapURL).then(function (map) {

      const polygonLayerName = "Counties";
      const polygonLayerURL =
        "https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/ACS_Median_Income_by_Race_and_Age_Selp_Emp_Boundaries/FeatureServer/1/query?where=1%3D1&outFields=*&returnGeometry=true&f=geojson";

      const polygonSource = new ol.source.Vector({
        format: new ol.format.GeoJSON(),
        url: polygonLayerURL,

      });

      const polygonLayer = new ol.layer.Vector({
        source: polygonSource
      });

      map.addLayer(polygonLayer);


      // Add Esri attribution
      // Learn more in https://esriurl.com/attribution
      const source = map.getLayers().item(0).getSource();
      const poweredByEsriString = "Powered by <a href='https://www.esri.com/en-us/home' target='_blank'>Esri</a> | ";

      const attributionFn = source.getAttributions();
      if (attributionFn) {
        source.setAttributions((ViewStateLayerStateExtent) => {
          return [poweredByEsriString, ...attributionFn(ViewStateLayerStateExtent)];
        });
      } else source.setAttributions(poweredByEsriString);
    });

    </script>

  </body>

</html>